{"fileId":"4219922fea2e2bd3c691","fileName":"smoke.spec.ts","tests":[{"testId":"4219922fea2e2bd3c691-c3cd3b4b2f66366b1d17","title":"role kunde sees expected navigation items","projectName":"chromium","location":{"file":"smoke.spec.ts","line":41,"column":5},"duration":1237,"annotations":[],"tags":[],"outcome":"unexpected","path":["Smoke tests — navigation visibility per role"],"results":[{"duration":1237,"startTime":"2025-12-10T16:30:04.481Z","retry":0,"steps":[{"title":"Before Hooks","startTime":"2025-12-10T16:30:04.482Z","duration":452,"steps":[{"title":"beforeEach hook","startTime":"2025-12-10T16:30:04.482Z","duration":452,"steps":[{"title":"Fixture \"browser\"","startTime":"2025-12-10T16:30:04.486Z","duration":270,"steps":[{"title":"Launch browser","startTime":"2025-12-10T16:30:04.488Z","duration":268,"steps":[],"attachments":[],"count":1,"skipped":false}],"attachments":[],"count":1,"skipped":false},{"title":"Fixture \"context\"","startTime":"2025-12-10T16:30:04.757Z","duration":4,"steps":[{"title":"Create context","startTime":"2025-12-10T16:30:04.758Z","duration":3,"steps":[],"attachments":[],"count":1,"skipped":false}],"attachments":[],"count":1,"skipped":false},{"title":"Fixture \"page\"","startTime":"2025-12-10T16:30:04.761Z","duration":158,"steps":[{"title":"Create page","startTime":"2025-12-10T16:30:04.762Z","duration":157,"steps":[],"attachments":[],"count":1,"skipped":false}],"attachments":[],"count":1,"skipped":false},{"title":"Navigate to \"/\"","startTime":"2025-12-10T16:30:04.924Z","duration":10,"steps":[],"attachments":[],"location":{"file":"smoke.spec.ts","line":37,"column":16},"error":"Error: page.goto: net::ERR_CONNECTION_REFUSED at http://localhost:5173/\nCall log:\n\u001b[2m  - navigating to \"http://localhost:5173/\", waiting until \"load\"\u001b[22m\n","count":1,"skipped":false,"snippet":" \u001b[90m 36 |\u001b[39m     }\u001b[33m,\u001b[39m \u001b[32m'kunde'\u001b[39m)\u001b[33m;\u001b[39m\n \u001b[90m 37 |\u001b[39m     \u001b[36mawait\u001b[39m page\u001b[33m.\u001b[39mgoto(\u001b[32m'/'\u001b[39m)\u001b[33m;\u001b[39m\n \u001b[90m    |\u001b[39m \u001b[31m\u001b[1m               ^\u001b[22m\u001b[39m\u001b[0m\n \u001b[90m 38 |\u001b[39m   })\u001b[33m;\u001b[39m"}],"attachments":[],"location":{"file":"smoke.spec.ts","line":27,"column":8},"error":"Error: page.goto: net::ERR_CONNECTION_REFUSED at http://localhost:5173/\nCall log:\n\u001b[2m  - navigating to \"http://localhost:5173/\", waiting until \"load\"\u001b[22m\n","count":1,"skipped":false,"snippet":" \u001b[90m 26 |\u001b[39m test\u001b[33m.\u001b[39mdescribe(\u001b[32m'Smoke tests — navigation visibility per role'\u001b[39m\u001b[33m,\u001b[39m () \u001b[33m=>\u001b[39m {\n \u001b[90m 27 |\u001b[39m   test\u001b[33m.\u001b[39mbeforeEach(\u001b[36masync\u001b[39m ({ page }) \u001b[33m=>\u001b[39m {\n \u001b[90m    |\u001b[39m \u001b[31m\u001b[1m       ^\u001b[22m\u001b[39m\u001b[0m\n \u001b[90m 28 |\u001b[39m     \u001b[90m// Before the page loads, enable test auth and default role via localStorage\u001b[39m"}],"attachments":[],"error":"Error: page.goto: net::ERR_CONNECTION_REFUSED at http://localhost:5173/\nCall log:\n\u001b[2m  - navigating to \"http://localhost:5173/\", waiting until \"load\"\u001b[22m\n","count":1,"skipped":false},{"title":"After Hooks","startTime":"2025-12-10T16:30:04.934Z","duration":1063,"steps":[{"title":"Fixture \"page\"","startTime":"2025-12-10T16:30:04.934Z","duration":0,"steps":[],"attachments":[],"count":1,"skipped":false},{"title":"Fixture \"context\"","startTime":"2025-12-10T16:30:04.934Z","duration":1059,"steps":[{"title":"Close context","startTime":"2025-12-10T16:30:05.988Z","duration":5,"steps":[],"attachments":[],"count":1,"skipped":false}],"attachments":[],"count":1,"skipped":false}],"attachments":[],"count":1,"skipped":false},{"title":"Worker Cleanup","startTime":"2025-12-10T16:30:05.997Z","duration":16,"steps":[{"title":"Fixture \"browser\"","startTime":"2025-12-10T16:30:05.998Z","duration":14,"steps":[],"attachments":[],"count":1,"skipped":false}],"attachments":[],"count":1,"skipped":false}],"errors":[{"message":"Error: page.goto: net::ERR_CONNECTION_REFUSED at http://localhost:5173/\nCall log:\n\u001b[2m  - navigating to \"http://localhost:5173/\", waiting until \"load\"\u001b[22m\n\n\n\u001b[0m \u001b[90m 35 |\u001b[39m       }\n \u001b[90m 36 |\u001b[39m     }\u001b[33m,\u001b[39m \u001b[32m'kunde'\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 37 |\u001b[39m     \u001b[36mawait\u001b[39m page\u001b[33m.\u001b[39mgoto(\u001b[32m'/'\u001b[39m)\u001b[33m;\u001b[39m\n \u001b[90m    |\u001b[39m                \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n \u001b[90m 38 |\u001b[39m   })\u001b[33m;\u001b[39m\n \u001b[90m 39 |\u001b[39m\n \u001b[90m 40 |\u001b[39m   \u001b[36mfor\u001b[39m (\u001b[36mconst\u001b[39m role \u001b[36mof\u001b[39m \u001b[33mObject\u001b[39m\u001b[33m.\u001b[39mkeys(roleLabels)) {\u001b[0m\n\u001b[2m    at /Users/florianhoffmann/workspace/netzportal-prototype/e2e/smoke.spec.ts:37:16\u001b[22m","codeframe":"   1 | import { test, expect } from '@playwright/test';\n   2 |\n   3 | const roleLabels: Record<string, string> = {\n   4 |   kunde: 'Kunde',\n   5 |   installateur: 'Installateur',\n   6 |   kundenbetreuer: 'Kundenbetreuer',\n   7 | };\n   8 |\n   9 | const navByRole: Record<string, string[]> = {\n  10 |   kunde: ['Dashboard', 'Zählerstand', 'Nachrichten', 'Termine', 'Verbrauch', 'Anträge', 'Meine Daten', 'Rechtliches'],\n  11 |   installateur: ['Dashboard', 'Nachrichten', 'Termine', 'Anträge', 'Meine Daten'],\n  12 |   kundenbetreuer: ['Dashboard', 'Nachrichten', 'Termine', 'Anträge', 'Meine Daten'],\n  13 | };\n  14 |\n  15 | // Simple helper to open the RoleSwitcher and pick a role by its visible label.\n  16 | async function selectRole(page, label: string) {\n  17 |   // The RoleSwitcher shows the current role inside a SelectTrigger; click it to open options.\n  18 |   // We search for a visible element that contains the current role label and click its parent trigger.\n  19 |   // Fallback: click directly the SelectTrigger by role text.\n  20 |   const trigger = page.locator(`div:has-text(\"${label}\")`).first();\n  21 |   await trigger.click();\n  22 |   // Then click the item in the dropdown\n  23 |   await page.locator(`text=${label}`).click();\n  24 | }\n  25 |\n  26 | test.describe('Smoke tests — navigation visibility per role', () => {\n  27 |   test.beforeEach(async ({ page }) => {\n  28 |     // Before the page loads, enable test auth and default role via localStorage\n  29 |     await page.addInitScript((role) => {\n  30 |       try {\n  31 |         localStorage.setItem('TEST_AUTH', '1');\n  32 |         localStorage.setItem('TEST_ROLE', role as string);\n  33 |       } catch (e) {\n  34 |         // ignore\n  35 |       }\n  36 |     }, 'kunde');\n> 37 |     await page.goto('/');\n     |                ^ Error: page.goto: net::ERR_CONNECTION_REFUSED at http://localhost:5173/\n  38 |   });\n  39 |\n  40 |   for (const role of Object.keys(roleLabels)) {\n  41 |     test(`role ${role} sees expected navigation items`, async ({ page }) => {\n  42 |       const label = roleLabels[role];\n  43 |       // Update the TEST_ROLE before navigation to ensure AuthProvider picks it up.\n  44 |       await page.addInitScript((r) => {\n  45 |         try {\n  46 |           localStorage.setItem('TEST_AUTH', '1');\n  47 |           localStorage.setItem('TEST_ROLE', r as string);\n  48 |         } catch (e) {}\n  49 |       }, label.toLowerCase());\n  50 |       await page.reload();\n  51 |       // wait for the app shell to render and the sidebar to be present\n  52 |       await page.waitForSelector('header', { timeout: 10000 });\n  53 |       await page.waitForSelector('aside', { timeout: 10000 });\n  54 |       // small delay for UI updates\n  55 |       await page.waitForTimeout(200);\n  56 |\n  57 |       const expected = navByRole[role];\n  58 |       // Scope checks to the sidebar to avoid ambiguous matches elsewhere on the page\n  59 |       const sidebar = page.locator('aside').first();\n  60 |\n  61 |       for (const item of expected) {\n  62 |         const link = sidebar.getByRole('link', { name: item });\n  63 |         await expect(link.first()).toBeVisible({ timeout: 10000 });\n  64 |       }\n  65 |\n  66 |       // Also assert that items not expected are not visible in the sidebar\n  67 |       const allItems = Array.from(new Set(Object.values(navByRole).flat()));\n  68 |       const notExpected = allItems.filter((i) => !expected.includes(i));\n  69 |       for (const item of notExpected) {\n  70 |         const link = sidebar.getByRole('link', { name: item });\n  71 |         if (await link.count()) {\n  72 |           await expect(link.first()).not.toBeVisible({ timeout: 5000 });\n  73 |         }\n  74 |       }\n  75 |     });\n  76 |   }\n  77 | });\n  78 |\n  79 | //"}],"status":"failed","annotations":[],"attachments":[]}],"ok":false},{"testId":"4219922fea2e2bd3c691-cd6a66be740945e8c299","title":"role installateur sees expected navigation items","projectName":"chromium","location":{"file":"smoke.spec.ts","line":41,"column":5},"duration":1091,"annotations":[],"tags":[],"outcome":"unexpected","path":["Smoke tests — navigation visibility per role"],"results":[{"duration":1091,"startTime":"2025-12-10T16:30:06.227Z","retry":0,"steps":[{"title":"Before Hooks","startTime":"2025-12-10T16:30:06.228Z","duration":127,"steps":[{"title":"beforeEach hook","startTime":"2025-12-10T16:30:06.228Z","duration":127,"steps":[{"title":"Fixture \"browser\"","startTime":"2025-12-10T16:30:06.233Z","duration":78,"steps":[{"title":"Launch browser","startTime":"2025-12-10T16:30:06.235Z","duration":76,"steps":[],"attachments":[],"count":1,"skipped":false}],"attachments":[],"count":1,"skipped":false},{"title":"Fixture \"context\"","startTime":"2025-12-10T16:30:06.312Z","duration":5,"steps":[{"title":"Create context","startTime":"2025-12-10T16:30:06.313Z","duration":3,"steps":[],"attachments":[],"count":1,"skipped":false}],"attachments":[],"count":1,"skipped":false},{"title":"Fixture \"page\"","startTime":"2025-12-10T16:30:06.317Z","duration":33,"steps":[{"title":"Create page","startTime":"2025-12-10T16:30:06.317Z","duration":33,"steps":[],"attachments":[],"count":1,"skipped":false}],"attachments":[],"count":1,"skipped":false},{"title":"Navigate to \"/\"","startTime":"2025-12-10T16:30:06.351Z","duration":3,"steps":[],"attachments":[],"location":{"file":"smoke.spec.ts","line":37,"column":16},"error":"Error: page.goto: net::ERR_CONNECTION_REFUSED at http://localhost:5173/\nCall log:\n\u001b[2m  - navigating to \"http://localhost:5173/\", waiting until \"load\"\u001b[22m\n","count":1,"skipped":false,"snippet":" \u001b[90m 36 |\u001b[39m     }\u001b[33m,\u001b[39m \u001b[32m'kunde'\u001b[39m)\u001b[33m;\u001b[39m\n \u001b[90m 37 |\u001b[39m     \u001b[36mawait\u001b[39m page\u001b[33m.\u001b[39mgoto(\u001b[32m'/'\u001b[39m)\u001b[33m;\u001b[39m\n \u001b[90m    |\u001b[39m \u001b[31m\u001b[1m               ^\u001b[22m\u001b[39m\u001b[0m\n \u001b[90m 38 |\u001b[39m   })\u001b[33m;\u001b[39m"}],"attachments":[],"location":{"file":"smoke.spec.ts","line":27,"column":8},"error":"Error: page.goto: net::ERR_CONNECTION_REFUSED at http://localhost:5173/\nCall log:\n\u001b[2m  - navigating to \"http://localhost:5173/\", waiting until \"load\"\u001b[22m\n","count":1,"skipped":false,"snippet":" \u001b[90m 26 |\u001b[39m test\u001b[33m.\u001b[39mdescribe(\u001b[32m'Smoke tests — navigation visibility per role'\u001b[39m\u001b[33m,\u001b[39m () \u001b[33m=>\u001b[39m {\n \u001b[90m 27 |\u001b[39m   test\u001b[33m.\u001b[39mbeforeEach(\u001b[36masync\u001b[39m ({ page }) \u001b[33m=>\u001b[39m {\n \u001b[90m    |\u001b[39m \u001b[31m\u001b[1m       ^\u001b[22m\u001b[39m\u001b[0m\n \u001b[90m 28 |\u001b[39m     \u001b[90m// Before the page loads, enable test auth and default role via localStorage\u001b[39m"}],"attachments":[],"error":"Error: page.goto: net::ERR_CONNECTION_REFUSED at http://localhost:5173/\nCall log:\n\u001b[2m  - navigating to \"http://localhost:5173/\", waiting until \"load\"\u001b[22m\n","count":1,"skipped":false},{"title":"After Hooks","startTime":"2025-12-10T16:30:06.355Z","duration":1051,"steps":[{"title":"Fixture \"page\"","startTime":"2025-12-10T16:30:06.355Z","duration":0,"steps":[],"attachments":[],"count":1,"skipped":false},{"title":"Fixture \"context\"","startTime":"2025-12-10T16:30:06.355Z","duration":1047,"steps":[{"title":"Close context","startTime":"2025-12-10T16:30:07.398Z","duration":4,"steps":[],"attachments":[],"count":1,"skipped":false}],"attachments":[],"count":1,"skipped":false}],"attachments":[],"count":1,"skipped":false},{"title":"Worker Cleanup","startTime":"2025-12-10T16:30:07.406Z","duration":16,"steps":[{"title":"Fixture \"browser\"","startTime":"2025-12-10T16:30:07.407Z","duration":15,"steps":[],"attachments":[],"count":1,"skipped":false}],"attachments":[],"count":1,"skipped":false}],"errors":[{"message":"Error: page.goto: net::ERR_CONNECTION_REFUSED at http://localhost:5173/\nCall log:\n\u001b[2m  - navigating to \"http://localhost:5173/\", waiting until \"load\"\u001b[22m\n\n\n\u001b[0m \u001b[90m 35 |\u001b[39m       }\n \u001b[90m 36 |\u001b[39m     }\u001b[33m,\u001b[39m \u001b[32m'kunde'\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 37 |\u001b[39m     \u001b[36mawait\u001b[39m page\u001b[33m.\u001b[39mgoto(\u001b[32m'/'\u001b[39m)\u001b[33m;\u001b[39m\n \u001b[90m    |\u001b[39m                \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n \u001b[90m 38 |\u001b[39m   })\u001b[33m;\u001b[39m\n \u001b[90m 39 |\u001b[39m\n \u001b[90m 40 |\u001b[39m   \u001b[36mfor\u001b[39m (\u001b[36mconst\u001b[39m role \u001b[36mof\u001b[39m \u001b[33mObject\u001b[39m\u001b[33m.\u001b[39mkeys(roleLabels)) {\u001b[0m\n\u001b[2m    at /Users/florianhoffmann/workspace/netzportal-prototype/e2e/smoke.spec.ts:37:16\u001b[22m","codeframe":"   1 | import { test, expect } from '@playwright/test';\n   2 |\n   3 | const roleLabels: Record<string, string> = {\n   4 |   kunde: 'Kunde',\n   5 |   installateur: 'Installateur',\n   6 |   kundenbetreuer: 'Kundenbetreuer',\n   7 | };\n   8 |\n   9 | const navByRole: Record<string, string[]> = {\n  10 |   kunde: ['Dashboard', 'Zählerstand', 'Nachrichten', 'Termine', 'Verbrauch', 'Anträge', 'Meine Daten', 'Rechtliches'],\n  11 |   installateur: ['Dashboard', 'Nachrichten', 'Termine', 'Anträge', 'Meine Daten'],\n  12 |   kundenbetreuer: ['Dashboard', 'Nachrichten', 'Termine', 'Anträge', 'Meine Daten'],\n  13 | };\n  14 |\n  15 | // Simple helper to open the RoleSwitcher and pick a role by its visible label.\n  16 | async function selectRole(page, label: string) {\n  17 |   // The RoleSwitcher shows the current role inside a SelectTrigger; click it to open options.\n  18 |   // We search for a visible element that contains the current role label and click its parent trigger.\n  19 |   // Fallback: click directly the SelectTrigger by role text.\n  20 |   const trigger = page.locator(`div:has-text(\"${label}\")`).first();\n  21 |   await trigger.click();\n  22 |   // Then click the item in the dropdown\n  23 |   await page.locator(`text=${label}`).click();\n  24 | }\n  25 |\n  26 | test.describe('Smoke tests — navigation visibility per role', () => {\n  27 |   test.beforeEach(async ({ page }) => {\n  28 |     // Before the page loads, enable test auth and default role via localStorage\n  29 |     await page.addInitScript((role) => {\n  30 |       try {\n  31 |         localStorage.setItem('TEST_AUTH', '1');\n  32 |         localStorage.setItem('TEST_ROLE', role as string);\n  33 |       } catch (e) {\n  34 |         // ignore\n  35 |       }\n  36 |     }, 'kunde');\n> 37 |     await page.goto('/');\n     |                ^ Error: page.goto: net::ERR_CONNECTION_REFUSED at http://localhost:5173/\n  38 |   });\n  39 |\n  40 |   for (const role of Object.keys(roleLabels)) {\n  41 |     test(`role ${role} sees expected navigation items`, async ({ page }) => {\n  42 |       const label = roleLabels[role];\n  43 |       // Update the TEST_ROLE before navigation to ensure AuthProvider picks it up.\n  44 |       await page.addInitScript((r) => {\n  45 |         try {\n  46 |           localStorage.setItem('TEST_AUTH', '1');\n  47 |           localStorage.setItem('TEST_ROLE', r as string);\n  48 |         } catch (e) {}\n  49 |       }, label.toLowerCase());\n  50 |       await page.reload();\n  51 |       // wait for the app shell to render and the sidebar to be present\n  52 |       await page.waitForSelector('header', { timeout: 10000 });\n  53 |       await page.waitForSelector('aside', { timeout: 10000 });\n  54 |       // small delay for UI updates\n  55 |       await page.waitForTimeout(200);\n  56 |\n  57 |       const expected = navByRole[role];\n  58 |       // Scope checks to the sidebar to avoid ambiguous matches elsewhere on the page\n  59 |       const sidebar = page.locator('aside').first();\n  60 |\n  61 |       for (const item of expected) {\n  62 |         const link = sidebar.getByRole('link', { name: item });\n  63 |         await expect(link.first()).toBeVisible({ timeout: 10000 });\n  64 |       }\n  65 |\n  66 |       // Also assert that items not expected are not visible in the sidebar\n  67 |       const allItems = Array.from(new Set(Object.values(navByRole).flat()));\n  68 |       const notExpected = allItems.filter((i) => !expected.includes(i));\n  69 |       for (const item of notExpected) {\n  70 |         const link = sidebar.getByRole('link', { name: item });\n  71 |         if (await link.count()) {\n  72 |           await expect(link.first()).not.toBeVisible({ timeout: 5000 });\n  73 |         }\n  74 |       }\n  75 |     });\n  76 |   }\n  77 | });\n  78 |\n  79 | //"}],"status":"failed","annotations":[],"attachments":[]}],"ok":false},{"testId":"4219922fea2e2bd3c691-b729278e62d89a9011c2","title":"role kundenbetreuer sees expected navigation items","projectName":"chromium","location":{"file":"smoke.spec.ts","line":41,"column":5},"duration":1089,"annotations":[],"tags":[],"outcome":"unexpected","path":["Smoke tests — navigation visibility per role"],"results":[{"duration":1089,"startTime":"2025-12-10T16:30:07.640Z","retry":0,"steps":[{"title":"Before Hooks","startTime":"2025-12-10T16:30:07.641Z","duration":127,"steps":[{"title":"beforeEach hook","startTime":"2025-12-10T16:30:07.642Z","duration":126,"steps":[{"title":"Fixture \"browser\"","startTime":"2025-12-10T16:30:07.646Z","duration":80,"steps":[{"title":"Launch browser","startTime":"2025-12-10T16:30:07.647Z","duration":79,"steps":[],"attachments":[],"count":1,"skipped":false}],"attachments":[],"count":1,"skipped":false},{"title":"Fixture \"context\"","startTime":"2025-12-10T16:30:07.727Z","duration":4,"steps":[{"title":"Create context","startTime":"2025-12-10T16:30:07.727Z","duration":4,"steps":[],"attachments":[],"count":1,"skipped":false}],"attachments":[],"count":1,"skipped":false},{"title":"Fixture \"page\"","startTime":"2025-12-10T16:30:07.731Z","duration":32,"steps":[{"title":"Create page","startTime":"2025-12-10T16:30:07.732Z","duration":31,"steps":[],"attachments":[],"count":1,"skipped":false}],"attachments":[],"count":1,"skipped":false},{"title":"Navigate to \"/\"","startTime":"2025-12-10T16:30:07.765Z","duration":3,"steps":[],"attachments":[],"location":{"file":"smoke.spec.ts","line":37,"column":16},"error":"Error: page.goto: net::ERR_CONNECTION_REFUSED at http://localhost:5173/\nCall log:\n\u001b[2m  - navigating to \"http://localhost:5173/\", waiting until \"load\"\u001b[22m\n","count":1,"skipped":false,"snippet":" \u001b[90m 36 |\u001b[39m     }\u001b[33m,\u001b[39m \u001b[32m'kunde'\u001b[39m)\u001b[33m;\u001b[39m\n \u001b[90m 37 |\u001b[39m     \u001b[36mawait\u001b[39m page\u001b[33m.\u001b[39mgoto(\u001b[32m'/'\u001b[39m)\u001b[33m;\u001b[39m\n \u001b[90m    |\u001b[39m \u001b[31m\u001b[1m               ^\u001b[22m\u001b[39m\u001b[0m\n \u001b[90m 38 |\u001b[39m   })\u001b[33m;\u001b[39m"}],"attachments":[],"location":{"file":"smoke.spec.ts","line":27,"column":8},"error":"Error: page.goto: net::ERR_CONNECTION_REFUSED at http://localhost:5173/\nCall log:\n\u001b[2m  - navigating to \"http://localhost:5173/\", waiting until \"load\"\u001b[22m\n","count":1,"skipped":false,"snippet":" \u001b[90m 26 |\u001b[39m test\u001b[33m.\u001b[39mdescribe(\u001b[32m'Smoke tests — navigation visibility per role'\u001b[39m\u001b[33m,\u001b[39m () \u001b[33m=>\u001b[39m {\n \u001b[90m 27 |\u001b[39m   test\u001b[33m.\u001b[39mbeforeEach(\u001b[36masync\u001b[39m ({ page }) \u001b[33m=>\u001b[39m {\n \u001b[90m    |\u001b[39m \u001b[31m\u001b[1m       ^\u001b[22m\u001b[39m\u001b[0m\n \u001b[90m 28 |\u001b[39m     \u001b[90m// Before the page loads, enable test auth and default role via localStorage\u001b[39m"}],"attachments":[],"error":"Error: page.goto: net::ERR_CONNECTION_REFUSED at http://localhost:5173/\nCall log:\n\u001b[2m  - navigating to \"http://localhost:5173/\", waiting until \"load\"\u001b[22m\n","count":1,"skipped":false},{"title":"After Hooks","startTime":"2025-12-10T16:30:07.768Z","duration":1051,"steps":[{"title":"Fixture \"page\"","startTime":"2025-12-10T16:30:07.768Z","duration":0,"steps":[],"attachments":[],"count":1,"skipped":false},{"title":"Fixture \"context\"","startTime":"2025-12-10T16:30:07.768Z","duration":1047,"steps":[{"title":"Close context","startTime":"2025-12-10T16:30:08.811Z","duration":4,"steps":[],"attachments":[],"count":1,"skipped":false}],"attachments":[],"count":1,"skipped":false}],"attachments":[],"count":1,"skipped":false},{"title":"Worker Cleanup","startTime":"2025-12-10T16:30:08.820Z","duration":16,"steps":[{"title":"Fixture \"browser\"","startTime":"2025-12-10T16:30:08.820Z","duration":15,"steps":[],"attachments":[],"count":1,"skipped":false}],"attachments":[],"count":1,"skipped":false}],"errors":[{"message":"Error: page.goto: net::ERR_CONNECTION_REFUSED at http://localhost:5173/\nCall log:\n\u001b[2m  - navigating to \"http://localhost:5173/\", waiting until \"load\"\u001b[22m\n\n\n\u001b[0m \u001b[90m 35 |\u001b[39m       }\n \u001b[90m 36 |\u001b[39m     }\u001b[33m,\u001b[39m \u001b[32m'kunde'\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 37 |\u001b[39m     \u001b[36mawait\u001b[39m page\u001b[33m.\u001b[39mgoto(\u001b[32m'/'\u001b[39m)\u001b[33m;\u001b[39m\n \u001b[90m    |\u001b[39m                \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n \u001b[90m 38 |\u001b[39m   })\u001b[33m;\u001b[39m\n \u001b[90m 39 |\u001b[39m\n \u001b[90m 40 |\u001b[39m   \u001b[36mfor\u001b[39m (\u001b[36mconst\u001b[39m role \u001b[36mof\u001b[39m \u001b[33mObject\u001b[39m\u001b[33m.\u001b[39mkeys(roleLabels)) {\u001b[0m\n\u001b[2m    at /Users/florianhoffmann/workspace/netzportal-prototype/e2e/smoke.spec.ts:37:16\u001b[22m","codeframe":"   1 | import { test, expect } from '@playwright/test';\n   2 |\n   3 | const roleLabels: Record<string, string> = {\n   4 |   kunde: 'Kunde',\n   5 |   installateur: 'Installateur',\n   6 |   kundenbetreuer: 'Kundenbetreuer',\n   7 | };\n   8 |\n   9 | const navByRole: Record<string, string[]> = {\n  10 |   kunde: ['Dashboard', 'Zählerstand', 'Nachrichten', 'Termine', 'Verbrauch', 'Anträge', 'Meine Daten', 'Rechtliches'],\n  11 |   installateur: ['Dashboard', 'Nachrichten', 'Termine', 'Anträge', 'Meine Daten'],\n  12 |   kundenbetreuer: ['Dashboard', 'Nachrichten', 'Termine', 'Anträge', 'Meine Daten'],\n  13 | };\n  14 |\n  15 | // Simple helper to open the RoleSwitcher and pick a role by its visible label.\n  16 | async function selectRole(page, label: string) {\n  17 |   // The RoleSwitcher shows the current role inside a SelectTrigger; click it to open options.\n  18 |   // We search for a visible element that contains the current role label and click its parent trigger.\n  19 |   // Fallback: click directly the SelectTrigger by role text.\n  20 |   const trigger = page.locator(`div:has-text(\"${label}\")`).first();\n  21 |   await trigger.click();\n  22 |   // Then click the item in the dropdown\n  23 |   await page.locator(`text=${label}`).click();\n  24 | }\n  25 |\n  26 | test.describe('Smoke tests — navigation visibility per role', () => {\n  27 |   test.beforeEach(async ({ page }) => {\n  28 |     // Before the page loads, enable test auth and default role via localStorage\n  29 |     await page.addInitScript((role) => {\n  30 |       try {\n  31 |         localStorage.setItem('TEST_AUTH', '1');\n  32 |         localStorage.setItem('TEST_ROLE', role as string);\n  33 |       } catch (e) {\n  34 |         // ignore\n  35 |       }\n  36 |     }, 'kunde');\n> 37 |     await page.goto('/');\n     |                ^ Error: page.goto: net::ERR_CONNECTION_REFUSED at http://localhost:5173/\n  38 |   });\n  39 |\n  40 |   for (const role of Object.keys(roleLabels)) {\n  41 |     test(`role ${role} sees expected navigation items`, async ({ page }) => {\n  42 |       const label = roleLabels[role];\n  43 |       // Update the TEST_ROLE before navigation to ensure AuthProvider picks it up.\n  44 |       await page.addInitScript((r) => {\n  45 |         try {\n  46 |           localStorage.setItem('TEST_AUTH', '1');\n  47 |           localStorage.setItem('TEST_ROLE', r as string);\n  48 |         } catch (e) {}\n  49 |       }, label.toLowerCase());\n  50 |       await page.reload();\n  51 |       // wait for the app shell to render and the sidebar to be present\n  52 |       await page.waitForSelector('header', { timeout: 10000 });\n  53 |       await page.waitForSelector('aside', { timeout: 10000 });\n  54 |       // small delay for UI updates\n  55 |       await page.waitForTimeout(200);\n  56 |\n  57 |       const expected = navByRole[role];\n  58 |       // Scope checks to the sidebar to avoid ambiguous matches elsewhere on the page\n  59 |       const sidebar = page.locator('aside').first();\n  60 |\n  61 |       for (const item of expected) {\n  62 |         const link = sidebar.getByRole('link', { name: item });\n  63 |         await expect(link.first()).toBeVisible({ timeout: 10000 });\n  64 |       }\n  65 |\n  66 |       // Also assert that items not expected are not visible in the sidebar\n  67 |       const allItems = Array.from(new Set(Object.values(navByRole).flat()));\n  68 |       const notExpected = allItems.filter((i) => !expected.includes(i));\n  69 |       for (const item of notExpected) {\n  70 |         const link = sidebar.getByRole('link', { name: item });\n  71 |         if (await link.count()) {\n  72 |           await expect(link.first()).not.toBeVisible({ timeout: 5000 });\n  73 |         }\n  74 |       }\n  75 |     });\n  76 |   }\n  77 | });\n  78 |\n  79 | //"}],"status":"failed","annotations":[],"attachments":[]}],"ok":false}]}